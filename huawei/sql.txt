/*
Navicat MySQL Data Transfer

Source Server         : localhost
Source Server Version : 50527
Source Host           : 127.0.0.1:3306
Source Database       : huawei_db

Target Server Type    : MYSQL
Target Server Version : 50527
File Encoding         : 65001

Date: 2018-01-12 20:21:24
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for huawei_quota_value
-- ----------------------------
DROP TABLE IF EXISTS `huawei_quota_value`;
CREATE TABLE `huawei_quota_value` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `RESOURCE_CODE` varchar(80) NOT NULL COMMENT '由ip拼上RESOURCE_URN',
  `RESOURCE_URN` varchar(60) DEFAULT NULL COMMENT '资源标识',
  `RESOURCE_IP` varchar(100) DEFAULT NULL COMMENT '资源IP',
  `CPU_USAGE` varchar(50) DEFAULT NULL COMMENT 'CPU占用率',
  `CPU_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `MEM_USAGE` varchar(50) DEFAULT NULL COMMENT '内存占用率',
  `MEM_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `LOGIC_DISK_USAGE` varchar(50) DEFAULT NULL COMMENT '宿主机磁盘占用率',
  `LOGIC_DISK_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `DOM0_CPU_USAGE` varchar(50) DEFAULT NULL COMMENT 'Dom0的CPU占用率',
  `DOM0_CPU_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `DOM0_MEM_USAGE` varchar(50) DEFAULT NULL COMMENT 'Dom0的内存占用率',
  `DOM0_MEM_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `NIC_BYTE_IN` varchar(50) DEFAULT NULL COMMENT '网络流入流速',
  `NIC_BYTE_IN_UNIT` varchar(10) DEFAULT NULL,
  `NIC_BYTE_OUT` varchar(50) DEFAULT NULL COMMENT '网络流出流速',
  `NIC_BYTE_OUT_UNIT` varchar(10) DEFAULT NULL,
  `NIC_PKG_SEND` varchar(50) DEFAULT NULL COMMENT '网络发送包速',
  `NIC_PKG_SEND_UNIT` varchar(10) DEFAULT NULL,
  `NIC_PKG_RCV` varchar(50) DEFAULT NULL COMMENT '网络接收包速',
  `NIC_PKG_RCV_UNIT` varchar(10) DEFAULT NULL,
  `NIC_BYTE_IN_USAGE` varchar(50) DEFAULT NULL COMMENT '网络流入占用率',
  `NIC_BYTE_IN_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `NIC_BYTE_OUT_USAGE` varchar(50) DEFAULT NULL COMMENT '网络流出占用率',
  `NIC_BYTE_OUT_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `NIC_PKG_RX_DROP_SPEED` varchar(50) DEFAULT NULL COMMENT '网络接收丢包速率',
  `NIC_PKG_RX_DROP_SPEED_UNIT` varchar(10) DEFAULT NULL,
  `NIC_PKG_TX_DROP_SPEED` varchar(50) DEFAULT NULL COMMENT '网络发送丢包速率',
  `NIC_PKG_TX_DROP_SPEED_UNIT` varchar(10) DEFAULT NULL,
  `DISK_IO_IN` varchar(50) DEFAULT NULL COMMENT '磁盘I/O写入',
  `DISK_IO_IN_UNIT` varchar(10) DEFAULT NULL,
  `DISK_IO_OUT` varchar(50) DEFAULT NULL COMMENT '磁盘I/O读出',
  `DISK_IO_OUT_UNIT` varchar(10) DEFAULT NULL,
  `DISK_IO_READ` varchar(50) DEFAULT NULL COMMENT '磁盘读出次数',
  `DISK_IO_READ_UNIT` varchar(10) DEFAULT NULL,
  `DISK_IO_WRITE` varchar(50) DEFAULT NULL COMMENT '磁盘写入次数',
  `DISK_IO_WRITE_UNIT` varchar(10) DEFAULT NULL,
  `DOMU_CPU_USAGE` varchar(50) DEFAULT NULL COMMENT 'DomU的CPU占用率',
  `DOMU_CPU_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `DOMU_MEM_USAGE` varchar(50) DEFAULT NULL COMMENT 'DomU的内存占用率',
  `DOMU_MEM_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `DISK_USAGE` varchar(50) DEFAULT NULL COMMENT '虚拟机磁盘占用率',
  `DISK_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `DISK_REQ_IN` varchar(50) DEFAULT NULL COMMENT '磁盘写请求次数',
  `DISK_REQ_IN_UNIT` varchar(10) DEFAULT NULL,
  `DISK_REQ_OUT` varchar(50) DEFAULT NULL COMMENT '磁盘读请求次数',
  `DISK_REQ_OUT_UNIT` varchar(10) DEFAULT NULL,
  `DISK_RD_IOS` varchar(50) DEFAULT NULL COMMENT '磁盘读操作次数',
  `DISK_RD_IOS_UNIT` varchar(10) DEFAULT NULL,
  `DISK_WR_IOS` varchar(50) DEFAULT NULL COMMENT '磁盘写操作次数',
  `DISK_WR_IOS_UNIT` varchar(10) DEFAULT NULL,
  `DISK_IOWR_TICKS` varchar(50) DEFAULT NULL COMMENT '磁盘平均写时延',
  `DISK_IOWR_TICKS_UNIT` varchar(10) DEFAULT NULL,
  `DISK_IORD_TICKS` varchar(50) DEFAULT NULL COMMENT '磁盘平均读时延',
  `DISK_IORD_TICKS_UNIT` varchar(10) DEFAULT NULL,
  `DISK_RD_SECTORS` varchar(50) DEFAULT NULL COMMENT '平均读块大小',
  `DISK_RD_SECTORS_UNIT` varchar(10) DEFAULT NULL,
  `DISK_WR_SECTORS` varchar(50) DEFAULT NULL COMMENT '平均写块大小',
  `DISK_WR_SECTORS_UNIT` varchar(10) DEFAULT NULL,
  `DISK_TOT_TICKS` varchar(50) DEFAULT NULL COMMENT '磁盘平均IO利用率',
  `DISK_TOT_TICKS_UNIT` varchar(10) DEFAULT NULL,
  `NIC_BYTE_IN_OUT` varchar(50) DEFAULT NULL COMMENT '网络平均带宽',
  `NIC_BYTE_IN_OUT_UNIT` varchar(10) DEFAULT NULL,
  `CPU_READY_TIME` varchar(50) DEFAULT NULL COMMENT '平均CPU就绪时间，VCPU处于就绪状态等CPU运行的时间',
  `CPU_READY_TIME_UNIT` varchar(10) DEFAULT NULL,
  `NIC_RX_DROP_PKT_SPEED` varchar(50) DEFAULT NULL COMMENT '网络接收丢包速率',
  `NIC_RX_DROP_PKT_SPEED_UNIT` varchar(10) DEFAULT NULL,
  `NIC_TX_DROP_PKT_SPEED` varchar(50) DEFAULT NULL COMMENT '网络发送丢包速率',
  `NIC_TX_DROP_PKT_SPEED_UNIT` varchar(10) DEFAULT NULL,
  `MEM_SIZE` varchar(50) DEFAULT NULL COMMENT '宿主机内存总量',
  `MEM_SIZE_UNIT` varchar(10) DEFAULT NULL,
  `DISK_TOTAL` varchar(50) DEFAULT NULL COMMENT '宿主机磁盘总量',
  `DISK_TOTAL_UNIT` varchar(10) DEFAULT NULL,
  `MEM_FREE` varchar(50) DEFAULT NULL COMMENT '虚拟机内存可用量',
  `MEM_FREE_UNIT` varchar(10) DEFAULT NULL,
  `MEM_TOTAL` varchar(50) DEFAULT NULL COMMENT '虚拟机内存总量',
  `MEM_TOTAL_UNIT` varchar(10) DEFAULT NULL,
  `DISK_INFO` varchar(50) DEFAULT NULL COMMENT '虚拟机磁盘总量',
  `DISK_INFO_UNIT` varchar(10) DEFAULT NULL,

  `VM_MEM_USAGE` varchar(50) DEFAULT NULL COMMENT '宿主机下所有虚拟机内存资源占用率',
  `VM_MEM_USAGE_UNIT` varchar(10) DEFAULT NULL,
  `VM_MEM_TOTAL` varchar(50) DEFAULT NULL COMMENT '宿主机下所有虚拟内存资源容量',
  `VM_MEM_TOTAL_UNIT` varchar(10) DEFAULT NULL,
  `VM_MEM_FREE` varchar(50) DEFAULT NULL COMMENT '宿主机下所有可用虚拟内存资源',
  `VM_MEM_FREE_UNIT` varchar(10) DEFAULT NULL,
  `VM_RUN_NUM` varchar(50) DEFAULT NULL COMMENT '宿主机下虚拟机运行数量',
  `VM_RUN_NUM_UNIT` varchar(10) DEFAULT NULL,
  `HOSTS_VIO_IN` varchar(50) DEFAULT NULL COMMENT '宿主机下所有虚拟机磁盘I/O流入',
  `HOSTS_VIO_IN_UNIT` varchar(10) DEFAULT NULL,
  `HOSTS_VIO_OUT` varchar(50) DEFAULT NULL COMMENT '宿主机下所有虚拟机磁盘I/O流出',
  `HOSTS_VIO_OUT_UNIT` varchar(10) DEFAULT NULL,
  `HOSTS_VBYTE_IN` varchar(50) DEFAULT NULL COMMENT '宿主机下所有虚拟机网络流出流速',
  `HOSTS_VBYTE_IN_UNIT` varchar(10) DEFAULT NULL,
  `HOSTS_VBYTE_OUT` varchar(50) DEFAULT NULL COMMENT '宿主机下所有虚拟机网络流入流速',
  `HOSTS_VBYTE_OUT_UNIT` varchar(10) DEFAULT NULL,

  `INSERT_TIME` datetime DEFAULT NULL COMMENT '调用接口时间',
  `COLLECT_TIME` datetime DEFAULT NULL COMMENT '本地采集时间',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- ----------------------------
-- Table structure for huawei_resource
-- ----------------------------
DROP TABLE IF EXISTS `huawei_resource`;
CREATE TABLE `huawei_resource` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `RESOURCE_CODE` varchar(80) NOT NULL,
  `RESOURCE_NAME` varchar(30) DEFAULT NULL,
  `RESOURCE_URN` varchar(60) DEFAULT NULL COMMENT '资源标识',
  `RESOURCE_IP` varchar(100) DEFAULT NULL COMMENT '资源IP',
  `RESOURCE_DESCRIPTION` varchar(100) DEFAULT NULL COMMENT '资源描述信息',
  `STATUS` varchar(20) DEFAULT NULL COMMENT '宿主机状态：rebooting 重启中，normal 正常，fault 故障，initial 初始化，unknow 未知，poweroff 离线（离线状态仅表示 vrm 已对主机下发关机命令，并且与主机的心跳中断，不确认主机真正下电），booting 上电中，shutdowning 下电中；虚拟机状态：running 运行中，stopped 已停止，unknown 不明确，hibernated 已休眠，creating 创建中或模板正在部署虚拟机或正在导入模板，shutting-down 删除中，migrating 迁移中，fault-resuming 故障恢复中，starting 启动中，stopping 停止中，hibernating 休眠中，pause 已暂停，recycling 回收中',
  `TYPE` varchar(10) DEFAULT NULL COMMENT '宿主机 hosts，虚拟机 vms',
  `HOST_URN` varchar(60) DEFAULT NULL COMMENT '虚拟机所在的宿主机URN',
  `TERRACE_IP` varchar(17) DEFAULT NULL COMMENT '所在平台IP',
  `SITE_URI` varchar(60) DEFAULT NULL COMMENT '所属站点标识',
  `MANAGE_TIME` datetime DEFAULT NULL COMMENT '资源更新时间',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- ----------------------------
-- Table structure for huawei_alram
-- ----------------------------
DROP TABLE IF EXISTS `huawei_alram`;
CREATE TABLE `huawei_alarm` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `RESOURCE_URN` varchar(60) DEFAULT NULL COMMENT '资源标识',
  `RESOURCE_NAME` varchar(255) DEFAULT NULL COMMENT '资源名称',
  `TERRACE_IP` varchar(17) DEFAULT NULL COMMENT '所在平台IP',
  `SITE_URI` varchar(60) DEFAULT NULL COMMENT '所属站点标识',
  `I_SERIAL_NO` varchar(30) DEFAULT NULL COMMENT '告警流水号',
  `SV_ALARM_ID` varchar(40) DEFAULT NULL COMMENT '告警ID',
  `SV_MOC` varchar(20) DEFAULT NULL COMMENT '告警对象类别',
  `SV_ALARM_NAME` varchar(40) DEFAULT NULL COMMENT '告警名称',
  `I_ALARM_CATEGORY` varchar(20) DEFAULT NULL COMMENT '告警类别',
  `I_ALARM_LEVEL` varchar(10) DEFAULT NULL COMMENT '告警级别',
  `SV_ALARM_CAUSE` varchar(100) DEFAULT NULL COMMENT '告警产生原因',
  `SV_ADDITIONAL_INFO` text COMMENT '告警详细说明',
  `DT_OCCUR_TIME` varchar(30) DEFAULT NULL COMMENT '告警产生时间',
  `DT_UPDATE_TIME` varchar(30) DEFAULT NULL COMMENT '告警更新时间',
  `COLLECT_TIME` varchar(30) DEFAULT NULL COMMENT '本地采集时间',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

/*
	查看是否开启事件调度器
*/
SHOW VARIABLES LIKE 'event_scheduler';
/*
	开启事件调度器
*/
SET GLOBAL event_scheduler = ON;
/*
	创建删除七天前指标数据的事件
*/
CREATE EVENT event_huawei_value_delete_7daysago
ON SCHEDULE EVERY 1 DAY
STARTS '2018-01-16 00:00:00'
DO DELETE FROM [库名].huawei_quota_value WHERE DATE_FORMAT(COLLECT_TIME,"%Y-%m-%d") <= SUBDATE(NOW(),INTERVAL 7 DAY);
/*
    创建删除七天前告警数据的事件
*/
CREATE EVENT event_huawei_alarm_delete_7daysago
ON SCHEDULE EVERY 1 DAY
STARTS '2018-01-16 00:00:00'
DO DELETE FROM [库名].huawei_alarm WHERE DATE_FORMAT(COLLECT_TIME,"%Y-%m-%d") <= SUBDATE(NOW(),INTERVAL 7 DAY);
/*
	启用事件
	关闭事件 ALTER EVENT 事件名 DISABLE;
*/
ALTER EVENT event_huawei_value_delete_7daysago ENABLE;
ALTER EVENT event_huawei_alarm_delete_7daysago ENABLE;
/*
	删除事件 DROP EVENT 事件名;
*/
/*
	查看事件 SHOW EVENT;
*/


/*
	添加到collent配置文件中的数据
*/
id,RESOURCE_CODE,RESOURCE_NAME,RESOURCE_URN,RESOURCE_IP,RESOURCE_DESCRIPTION,STATUS,TYPE,HOST_URN,TERRACE_IP,SITE_URI,MANAGE_TIME|huawei_resource&id,RESOURCE_CODE,RESOURCE_URN,RESOURCE_IP,CPU_USAGE,CPU_USAGE_UNIT,MEM_USAGE,MEM_USAGE_UNIT,LOGIC_DISK_USAGE,LOGIC_DISK_USAGE_UNIT,DOM0_CPU_USAGE,DOM0_CPU_USAGE_UNIT,DOM0_MEM_USAGE,DOM0_MEM_USAGE_UNIT,NIC_BYTE_IN,NIC_BYTE_IN_UNIT,NIC_BYTE_OUT,NIC_BYTE_OUT_UNIT,NIC_PKG_SEND,NIC_PKG_SEND_UNIT,NIC_PKG_RCV,NIC_PKG_RCV_UNIT,NIC_BYTE_IN_USAGE,NIC_BYTE_IN_USAGE_UNIT,NIC_BYTE_OUT_USAGE,NIC_BYTE_OUT_USAGE_UNIT,NIC_PKG_RX_DROP_SPEED,NIC_PKG_RX_DROP_SPEED_UNIT,NIC_PKG_TX_DROP_SPEED,NIC_PKG_TX_DROP_SPEED_UNIT,DISK_IO_IN,DISK_IO_IN_UNIT,DISK_IO_OUT,DISK_IO_OUT_UNIT,DISK_IO_READ,DISK_IO_READ_UNIT,DISK_IO_WRITE,DISK_IO_WRITE_UNIT,DOMU_CPU_USAGE,DOMU_CPU_USAGE_UNIT,DOMU_MEM_USAGE,DOMU_MEM_USAGE_UNIT,DISK_USAGE,DISK_USAGE_UNIT,DISK_REQ_IN,DISK_REQ_IN_UNIT,DISK_REQ_OUT,DISK_REQ_OUT_UNIT,DISK_RD_IOS,DISK_RD_IOS_UNIT,DISK_WR_IOS,DISK_WR_IOS_UNIT,DISK_IOWR_TICKS,DISK_IOWR_TICKS_UNIT,DISK_IORD_TICKS,DISK_IORD_TICKS_UNIT,DISK_RD_SECTORS,DISK_RD_SECTORS_UNIT,DISK_WR_SECTORS,DISK_WR_SECTORS_UNIT,DISK_TOT_TICKS,DISK_TOT_TICKS_UNIT,NIC_BYTE_IN_OUT,NIC_BYTE_IN_OUT_UNIT,CPU_READY_TIME,CPU_READY_TIME_UNIT,NIC_RX_DROP_PKT_SPEED,NIC_RX_DROP_PKT_SPEED_UNIT,NIC_TX_DROP_PKT_SPEED,NIC_TX_DROP_PKT_SPEED_UNIT,MEM_SIZE,MEM_SIZE_UNIT,DISK_TOTAL,DISK_TOTAL_UNIT,MEM_FREE,MEM_FREE_UNIT,MEM_TOTAL,MEM_TOTAL_UNIT,DISK_INFO,DISK_INFO_UNIT,VM_MEM_USAGE,VM_MEM_USAGE_UNIT,VM_MEM_TOTAL,VM_MEM_TOTAL_UNIT,VM_MEM_FREE,VM_MEM_FREE_UNIT,VM_RUN_NUM,VM_RUN_NUM_UNIT,HOSTS_VIO_IN,HOSTS_VIO_IN_UNIT,HOSTS_VIO_OUT,HOSTS_VIO_OUT_UNIT,HOSTS_VBYTE_IN,HOSTS_VBYTE_IN_UNIT,HOSTS_VBYTE_OUT,HOSTS_VBYTE_OUT_UNIT,INSERT_TIME,COLLECT_TIME|huawei_quota_value
